# Step-3: CQ Validation

## 개요

LlamaIndex Text2Cypher를 사용하여 IP/특허 담당자 페르소나 기반 100개 테스트 케이스로 검증한다.

## Sub-step

| Sub-step | 내용 | 상태 |
|----------|------|------|
| 3-1 | LlamaIndex Text2Cypher 연동 | ✅ 완료 |
| 3-2 | 100개 테스트 케이스 검증 | ✅ 완료 (67%) |

## 기술 스택

| 구성 요소 | 선택 |
|-----------|------|
| Framework | LlamaIndex |
| LLM Provider | OpenRouter |
| LLM Model | Gemini 2.0 Flash |
| Retriever | TextToCypherRetriever |

## 검증 결과 (v3.0 - IP/특허 담당자 페르소나)

| 지표 | 결과 |
|------|------|
| 성공 (PASS) | 67개 (67%) |
| 데이터 없음 (NO_DATA) | 33개 (33%) |
| 실패 (FAIL) | 0개 (0%) |
| **쿼리 성공률** | **100%** |

**참고**: NO_DATA는 Cypher 쿼리 자체는 성공했지만 데이터가 0개 반환된 경우

## CQ 유형별 결과

| CQ 유형 | Pass | No Data | Fail | 쿼리성공률 |
|---------|------|---------|------|-----------|
| CQ1-기술검색 | 10 | 0 | 0 | 100% |
| CQ1-미결이슈 | 5 | 0 | 0 | 100% |
| CQ2-기고서추적 | 5 | 5 | 0 | 100% |
| CQ3-스펙변경 | 1 | 4 | 0 | 100% |
| CQ4-회의별 | 7 | 3 | 0 | 100% |
| CQ5-결론추적 | 4 | 1 | 0 | 100% |
| CQ6-WA추적 | 5 | 0 | 0 | 100% |
| CQ7-CR추적 | 0 | 5 | 0 | 100% |
| CQ8-TP추적 | 2 | 3 | 0 | 100% |
| CQ9-LS추적 | 0 | 5 | 0 | 100% |
| CQ10-RRC | 4 | 1 | 0 | 100% |
| CQ11-UE동작 | 5 | 0 | 0 | 100% |
| CQ12-기타기술 | 5 | 0 | 0 | 100% |
| CQ13-Release | 2 | 3 | 0 | 100% |
| CQ14-복합검색 | 2 | 3 | 0 | 100% |
| CQ15-내용검색 | 10 | 0 | 0 | 100% |

## 테스트 데이터셋 v3.0 설계 원칙

### 페르소나: 3GPP RAN1 회의를 모니터링하는 IP/특허 담당자

### 질문 설계 원칙
1. **기술 키워드 중심 검색** - MIMO, NTN, positioning 등
2. **특정 기고서(Tdoc) 추적** - R1-XXXXXXX 형식
3. **스펙 변경사항 파악** - 38.211, 36.213 등
4. **미결 이슈(FFS/TBD) 확인**
5. **내부 ID 사용 금지** - 자연어만 사용

### 질문 유형 예시

| 유형 | 예시 질문 |
|------|----------|
| 기술검색 | "MIMO 관련해서 최근 합의된 내용 보여줘" |
| 미결이슈 | "아직 FFS로 남아있는 이슈들 뭐가 있어?" |
| 기고서추적 | "R1-2001347 문서가 반영된 결정 내용 알려줘" |
| 스펙변경 | "38.211 스펙 수정하는 CR 관련 합의 있어?" |
| 회의별 | "RAN1#120 회의에서 결정된 주요 사항들 보여줘" |

## NO_DATA 원인 분석

### 1. Agreement content 내 키워드 부재
- "CR", "LS", "corrections" 등 키워드가 content에 직접 포함되지 않은 경우
- 예: TC-051~055 (CR추적), TC-061~065 (LS추적)

### 2. 스펙 번호 형식 불일치
- 질문: "38.211" → DB content: "TS 38.211" 또는 "38.211" 다양한 형태
- 예: TC-026~030 (스펙변경)

### 3. Tdoc이 Agreement에 직접 참조되지 않음
- Tdoc이 존재하지만 REFERENCES 관계가 없는 경우
- 예: TC-016~025 중 일부

### 4. 회의 번호 + 키워드 복합 조건
- 회의에서 특정 기술 관련 결정이 없는 경우
- 예: TC-032, TC-037, TC-040

## 성공 패턴

### 100% 성공한 CQ 유형
1. **CQ1-기술검색**: 단순 키워드 검색 (MIMO, NTN, positioning 등)
2. **CQ1-미결이슈**: hasFFS/hasTBD 속성 활용
3. **CQ6-WA추적**: WorkingAssumption 노드 검색
4. **CQ11-UE동작**: UE behavior, PDSCH, PUSCH 등 키워드
5. **CQ12-기타기술**: switching, CA, SUL 등 키워드
6. **CQ15-내용검색**: 세부 기술 키워드 (resource pool, scheduling 등)

## 스크립트

| 스크립트 | 용도 |
|----------|------|
| `scripts/phase-3/validation/04_validate_cq_llamaindex.py` | LlamaIndex 기반 CQ 검증 |

## 로그 파일

| 파일 | 설명 |
|------|------|
| `logs/phase-3/cq_test_dataset_100.json` | 테스트 데이터셋 v3.0 (IP/특허 담당자 페르소나) |
| `logs/phase-3/cq_llamaindex_results.json` | LlamaIndex 검증 결과 |

## 검증 v4.0 예정 (2026-01-26)

### 개선 사항
- `canonicalMeetingNumber` 속성 추가 반영
- IP/특허 담당자 실무 기반 CQ 100개 재설계
- 상세 답변 포함 리포트 생성

### 질문 카테고리 (v4.0)
1. **SSB/PSS/SSS/PBCH** (20개) - 동기 신호 및 방송 채널
2. **MIMO/빔포밍** (15개) - 다중 안테나 기술
3. **채널 코딩/변조** (15개) - LDPC, Polar, QAM
4. **물리 채널 설계** (15개) - PDSCH, PUSCH, PUCCH, PRACH
5. **회의/의사결정 추적** (15개) - 특정 합의 근거 추적
6. **LTE vs NR 비교** (10개) - 기술 발전 추적
7. **회사/기여자 추적** (10개) - 특허 관련 기여자 식별

## 변경 이력

| 날짜 | 변경 내용 |
|------|----------|
| 2026-01-22 | 초기 검증 (55% - 스키마 충돌) |
| 2026-01-22 | 스키마 충돌 해결 후 재검증 (99% - 잘못된 DB 포트) |
| 2026-01-22 | CQ 설계 개선 사항 문서화 |
| 2026-01-23 | DB 포트 불일치 수정 (7688→7687), 검증 로직 개선 (NO_DATA 상태 추가) |
| 2026-01-23 | 재검증: PASS 70%, NO_DATA 29%, FAIL 1% (쿼리 성공률 99%) |
| 2026-01-23 | **테스트 데이터셋 v3.0 - IP/특허 담당자 페르소나 기반 재설계** |
| 2026-01-23 | **최종 검증: PASS 67%, NO_DATA 33%, FAIL 0% (쿼리 성공률 100%)** |
| 2026-01-26 | **테스트 데이터셋 v4.0 - 실무 기반 CQ 100개 재설계 예정** |
